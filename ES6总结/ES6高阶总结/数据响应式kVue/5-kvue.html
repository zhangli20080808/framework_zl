<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<div id="app">
    {{ message }}
    <div>
        <p>姓名:{{ name }}，年龄: {{age}}</p>
        <p v-html="htmlData"></p>
        <input type="text" v-model="modelData" />
        <p>{{modelData}}</p>
    </div>
    就是一段纯文本
</div>     
<script>    
class KVue {
    constructor(option){
        this.$option = option;
        let el = document.querySelector(option.el);
        this.compileNode(el);  
    }
    // 根据当前元素的结构，将我们的数据编译进去
    compileNode(el){
        let child = el.childNodes; // 找到元素下的所有节点
        child.forEach(node => {
            if(node.nodeType == 1){ // 如果该节点是元素节点
                let attrs = node.attributes;
                [...attrs].forEach(attr=>{
                    let attrName = attr.name;
                    if(attrName.indexOf("v-") == 0){
                        let attrVal = attr.value;
                        //console.log(attrName,attrVal);
                        if(attrName === "v-html" ){ // 这是一个v-html指令，我们应该用数据替换该元素的内容
                            node.innerHTML = this.$option.data[attrVal];
                        } else if(attrName == "v-model"){ // 这是一个双向绑定指令
                            node.value = this.$option.data[attrVal];

                            // 监听视图发生了变化，同步修改我们的数据
                            node.addEventListener("input",({target})=>{
                                this.$option.data[attrVal] = target.value;
                            });
                        }
                    }
                });

               if(node.childNodes.length > 0){ // 如果该元素还有子元素继续想要查找
                this.compileNode(node);  
               }
            } else if(node.nodeType == 3){ // 如果该节点是文本节点
                // console.log(node);
                //console.dir(node);
                let startContent = node.textContent;
                let reg = /\{\{\s*(\S+)\s*\}\}/g;
                //console.log(reg.test(startContent),startContent);
                if(reg.test(startContent)){
                    node.textContent = startContent.replace(reg,(...arg)=>{
                        //console.log(arg[1]);
                        return this.$option.data[arg[1]];
                    });
                }
            }
        });
    }
}  
let kvue = new KVue({
    el: "#app",
    data: {
       message: "Hello KKB",
       modelData: "呵呵",
       name: "kkb",
       age: 8,
       htmlData: "<strong>圣诞节要陪我一起过吗</strong>"
    }
});
</script>    
</body>
</html>